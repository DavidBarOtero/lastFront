{"ast":null,"code":"import _objectSpread from \"/home/david/Escritorio/frontSinBug/NiceEventFrontFinal-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/david/Escritorio/frontSinBug/NiceEventFrontFinal-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/david/Escritorio/frontSinBug/NiceEventFrontFinal-master/src/components/Api/auth-requests.js\";\nimport axios from \"axios\";\nimport React from \"react\";\nimport { useState, useContext, useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nconst AuthContext = React.createContext();\nconst currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\nconst currentToken = JSON.parse(localStorage.getItem(\"currentToken\"));\nexport function AuthProvider({\n  children\n}) {\n  const _useState = useState(currentUser !== null),\n        _useState2 = _slicedToArray(_useState, 2),\n        isAuthenticated = _useState2[0],\n        setIsAuthenticated = _useState2[1];\n\n  const _useState3 = useState(currentUser && currentUser.user),\n        _useState4 = _slicedToArray(_useState3, 2),\n        user = _useState4[0],\n        setUser = _useState4[1];\n\n  const _useState5 = useState(currentToken && currentToken.token),\n        _useState6 = _slicedToArray(_useState5, 2),\n        tokenOk = _useState6[0],\n        setTokenOk = _useState6[1];\n\n  const history = useHistory();\n\n  const login = async (email, password) => {\n    return axios.post(`${process.env.REACT_APP_BACKEND}/api/auth`, {\n      auth: {\n        email: email,\n        password\n      }\n    });\n  };\n\n  useEffect(() => {\n    if (isAuthenticated) {\n      history.push(\"/index\");\n    }\n  }, [isAuthenticated]);\n\n  function register({\n    name,\n    lastName,\n    email,\n    password,\n    profession,\n    city,\n    fee,\n    state\n  }) {\n    return axios.post(`${process.env.REACT_APP_BACKEND}/api/account`, {\n      name,\n      lastName,\n      email,\n      password\n    }).then(res => {\n      const result = _objectSpread({}, res.data);\n\n      console.log(result);\n    }).catch(error => {\n      if (error.response.status === 409 || error.response.status === 500) {\n        history.push(\"/\");\n      }\n    });\n  }\n\n  async function signIn(email, password) {\n    try {\n      const _ref = await login(email, password),\n            _ref$data = _ref.data,\n            tokenOk = _ref$data.tokenOk,\n            expireIn = _ref$data.expireIn;\n\n      setUser(email);\n      setIsAuthenticated(true);\n      setTokenOk(tokenOk);\n\n      if (tokenOk) {\n        history.push(\"/index\");\n      }\n\n      console.log(tokenOk);\n    } catch (error) {\n      console.log(\"error en front\");\n      return Promise.reject(error);\n    }\n  }\n\n  async function signUp(name, lastName, email, password) {\n    try {\n      await register({\n        name,\n        lastName,\n        email,\n        password\n      });\n      setUser(user);\n      setIsAuthenticated(true);\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n\n  const logout = () => {\n    setUser(null);\n    setIsAuthenticated(false);\n    localStorage.removeItem(\"currentUser\");\n  };\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      login,\n      signIn,\n      signUp,\n      isAuthenticated,\n      setIsAuthenticated,\n      user,\n      tokenOk,\n      logout\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, children);\n}\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  return context;\n}","map":{"version":3,"sources":["/home/david/Escritorio/frontSinBug/NiceEventFrontFinal-master/src/components/Api/auth-requests.js"],"names":["axios","React","useState","useContext","useEffect","useHistory","AuthContext","createContext","currentUser","JSON","parse","localStorage","getItem","currentToken","AuthProvider","children","isAuthenticated","setIsAuthenticated","user","setUser","token","tokenOk","setTokenOk","history","login","email","password","post","process","env","REACT_APP_BACKEND","auth","push","register","name","lastName","profession","city","fee","state","then","res","result","data","console","log","catch","error","response","status","signIn","expireIn","Promise","reject","signUp","logout","removeItem","useAuth","context"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport React from \"react\";\nimport { useState, useContext, useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\n\nconst AuthContext = React.createContext();\nconst currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\nconst currentToken = JSON.parse(localStorage.getItem(\"currentToken\"));\nexport function AuthProvider({ children }) {\n  const [isAuthenticated, setIsAuthenticated] = useState(currentUser !== null);\n  const [user, setUser] = useState(currentUser && currentUser.user);\n  const [tokenOk, setTokenOk] = useState(currentToken && currentToken.token);\n  const history = useHistory();\n\n  const login = async (email, password) => {\n    return axios.post(`${process.env.REACT_APP_BACKEND}/api/auth`, {\n      auth: {\n        email: email,\n        password\n      }\n    });\n  };\n  useEffect(() => {\n    if (isAuthenticated) {\n      history.push(\"/index\");\n    }\n  }, [isAuthenticated]);\n\n  function register({\n    name,\n    lastName,\n    email,\n    password,\n    profession,\n    city,\n    fee,\n    state\n  }) {\n    return axios\n      .post(`${process.env.REACT_APP_BACKEND}/api/account`, {\n        name,\n        lastName,\n        email,\n        password\n      })\n      .then(res => {\n        const result = { ...res.data };\n        console.log(result);\n      })\n\n      .catch(error => {\n        if (error.response.status === 409 || error.response.status === 500) {\n          history.push(\"/\");\n        }\n      });\n  }\n\n  async function signIn(email, password) {\n    try {\n      const {\n        data: { tokenOk, expireIn }\n      } = await login(email, password);\n      setUser(email);\n      setIsAuthenticated(true);\n      setTokenOk(tokenOk);\n\n      if (tokenOk) {\n        history.push(\"/index\");\n      }\n      console.log(tokenOk);\n    } catch (error) {\n      console.log(\"error en front\");\n      return Promise.reject(error);\n    }\n  }\n  async function signUp(name, lastName, email, password) {\n    try {\n      await register({\n        name,\n        lastName,\n        email,\n        password\n      });\n      setUser(user);\n      setIsAuthenticated(true);\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n\n  const logout = () => {\n    setUser(null);\n    setIsAuthenticated(false);\n    localStorage.removeItem(\"currentUser\");\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        login,\n        signIn,\n        signUp,\n        isAuthenticated,\n        setIsAuthenticated,\n        user,\n        tokenOk,\n        logout\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  return context;\n}\n"]},"metadata":{},"sourceType":"module"}